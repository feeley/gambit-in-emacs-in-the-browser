// @require container.js
(function(){function DlGrid(args){args&&(D.setDefaults(this,args),typeof this._rowType=="string"&&(this._rowType=eval(this._rowType)),this._rowType||(this._rowType=DlGridRow),typeof this._headType=="string"&&(this._headType=eval(this._headType)),this._headType||(this._headType=DlGridHeadLabel),DlContainer.call(this,args))}function onBodyScroll(){this.getHeaderDiv().scrollLeft=this.getBodyDiv().scrollLeft}function startResize(e,t,n){var r,i,s,o,u;n||(n=window.event),r=e.offsetLeft,i=DlResizeBar.getDragBar(),s=i.style,s.left=r-this.getBodyDiv().scrollLeft+1+"px",s.height="100%",s.width=e.offsetWidth-2+"px",s.top="0px",this.getElement().appendChild(i),o=DlDialog.activateEventStopper(!0),DOM.addClass(o,"CURSOR-RESIZE-E"),DlEvent.captureGlobals(this._resizeCaptures),u=new DlEvent(n),this._resize={div:e,col:t,pos:r,orig:this.getActualColWidth(t.getIndex()),mouse:u.pos.x},DOM.stopEvent(n)}function doResize(e){var t=DlResizeBar.getDragBar(),n=this._resize.pos+e.pos.x-this._resize.mouse,r=n-this._resize.pos,i=this._resize.orig+r;i<MIN_COL_WID&&(n+=MIN_COL_WID-i,i=MIN_COL_WID),n-=this.getBodyDiv().scrollLeft,t.style.left=n+1+"px"}function stopResize(e){var t,n=this._resize.pos+e.pos.x-this._resize.mouse,r=n-this._resize.pos,i=this._resize.orig+r;i<MIN_COL_WID&&(n+=MIN_COL_WID-i,i=MIN_COL_WID),r=i-this._resize.orig,this.setColSize(this._resize.col,i),this._updateFillCols(r),this.getElement().removeChild(DlResizeBar.getDragBar()),DlEvent.releaseGlobals(this._resizeCaptures),t=DlDialog.activateEventStopper(!1),DOM.delClass(t,"CURSOR-RESIZE-E")}var MIN_COL_WID,SO,SI,HTML,BASE=DlGrid.inherits(DlContainer);eval(Dynarch.EXPORT("DlGrid",!0)),MIN_COL_WID=20,D.DEFAULT_ARGS={_model:["model",null],_selType:["selType","row"],_rowType:["rowType",null],_headType:["headType",null]},SO=DOM.setOuterSize,SI=DOM.setInnerSize,HTML=String.buffer("<div class='DlGrid-Headers'>","<table class='DlGrid-Table' cellspacing='0' cellpadding='0'>","<tbody><tr></tr></tbody></table></div>","<div class='DlGrid-Body'>","<table class='DlGrid-Table' cellspacing='0' cellpadding='0'>","<tbody></tbody></table></div>").get(),P._createElement=function(){BASE._createElement.call(this),this._rowsGroup=DlRadioGroup.get(),this.setContent(HTML),this.getBodyDiv().onscroll=onBodyScroll.$(this),this._initHeaders(),this._initBody()},P.getGroup=function(){return this._rowsGroup},P.getHeaderDiv=function(){return this.getElement().firstChild},P.getHandlesDiv=function(){var e=this.getHeaderDiv().childNodes[1];return e||(e=CE("div",null,{className:"DlGrid-Handles"},this.getHeaderDiv()),this._resizeCaptures={onMouseMove:doResize.$(this),onMouseUp:stopResize.$(this),onMouseOver:DlException.stopEventBubbling,onMouseOut:DlException.stopEventBubbling,onMouseEnter:DlException.stopEventBubbling,onMouseLeave:DlException.stopEventBubbling}),e},P.getHeaderRow=function(){return this.getHeaderDiv().firstChild.rows[0]},P.getBodyDiv=function(){return this.getElement().childNodes[1]},P.getBodyTable=function(){return this.getBodyDiv().firstChild},P._onHeadClick=function(){},P._appendWidgetElement=function(e,t){var n,r;e instanceof this._rowType?(n=this.getBodyTable(),t!=null?(r=n.rows[t],r?r.parentNode.insertBefore(e.getElement(),r):n.firstChild.appendChild(e.getElement())):n.firstChild.appendChild(e.getElement())):BASE._appendWidgetElement.apply(this,arguments)},P._initHeaders=function(){var e=this._onHeadClick.$(this);this._model.foreachCol(function(t){var n,r=document.createElement("td");this.getHeaderRow().appendChild(r),n=this._makeHeadLabel({parent:this,appendArgs:r,iconClass:t.getIconClass(),label:t.getLabel(),column:t,className:"DlGrid-align-"+t.getStyle("textAlign","left"),tooltip:t.tooltip}),t._button=n,n.addEventListener("onClick",e)},this)},P._makeRow=function(e){return new this._rowType(e)},P._makeHeadLabel=function(e){return new this._headType(e)},P._initBody=function(){this._model.foreachRow(function(e){e=this._makeRow({parent:this,group:this._rowsGroup,value:e.id,model:e})},this),this._model.addEventListener({onInsertRow:this._insertRow.$(this),onDeleteRow:this._deleteRow.$(this),onSort:this._sort.$(this)})},P._insertRow=function(e){var t,n,r,i,s,o=e.getIndex();e=this._makeRow({parent:this,group:this._rowsGroup,value:e.id,model:e,appendArgs:o}),t=e.getElement().cells,n=this.getHeaderRow().cells;for(r=t.length;--r>=0;)i=t[r],s=n[r].offsetWidth,SO(i.firstChild,s,null),SI(i,s,null)},P._deleteRow=function(e){var t=e.getIndex();e=this.getRowByIndex(t),e.destroy()},P._sort=function(e,t,n,r){var i,s,o;t&&(t._button.delClass("DlGridHeadLabel-sort-up"),t._button.delClass("DlGridHeadLabel-sort-down")),e&&(e._button.condClass(n,"DlGridHeadLabel-sort-down","DlGridHeadLabel-sort-up"),i=this.getBodyTable(),s=i.firstChild,o=i.rows,r=r.map(function(e){return o[e]}),r.foreach(function(e){s.appendChild(e)}))},P.__doLayout=function(){var e=this.getInnerSize(),t=this.getBodyDiv(),n=this.getHeaderDiv();SO(t,e.x,e.y-n.offsetHeight),SO(n,e.x,null),n.style.marginRight=-DOM.getScrollbarSize(t).x+"px",this.__hasLayout?this._updateFillCols():(this._initColSizes(),this.__hasLayout=!0,this.getBodyTable().style.width=""),onBodyScroll.call(this)},P.getRowByIndex=function(e){try{return DlWidget.getFromElement(this.getBodyTable().rows[e])}catch(t){}},P.getRowById=function(e){return this.getRowByIndex(this._model.getRowById(e).getIndex())},P.getActualColWidth=function(e){return this.getHeaderRow().cells[e].offsetWidth},P._initColSizes=function(){function i(r){var i,s=r.fill?Math.floor(e*r.fill):r.width||this.getActualColWidth(r.getIndex());s=this.setColSize(r,s,!0),n+=s,r.isResizable&&!r._resizeHandle&&(i=CE("div",{left:n+"px",height:t},{className:"DlGrid-resizeHandle"},this.getHandlesDiv()),is_ie&&DOM.setUnselectable(i,!0),i.dl_resizeCol=r,r._resizeHandle=i,i.onmousedown=startResize.$(this,i,r))}var e,t=this.getHeaderDiv().offsetHeight+"px",n=0,r=this.getInnerSize().x-DOM.getScrollbarSize(this.getBodyDiv()).x;this._fillCols=[],this._model.foreachCol(function(e){e.fill?this._fillCols.push(e):n+=e.width||this.getActualColWidth(e.getIndex())},this),e=r-n,n=0,this._model.foreachCol(i,this)},P.setColSize=function(e,t,n){var r,i,s=e._button;return t!=null&&(s.setOuterSize({x:t}),r=s.getElement().parentNode,SO(r,t,null)),i=this.getBodyTable().rows[0],t=s.getOuterSize().x,e=e.getIndex(),Array.$(this.getBodyTable().rows).foreach(function(n){n&&(r=n.cells[e],SO(r.firstChild,t,null),SI(r,t,null))}),onBodyScroll.call(this),n||this._updateResizeHandles(),t},P._updateFillCols=function(e){var t;e==null&&(t=this.getBodyDiv(),e=this.getHeaderRow().offsetWidth-t.offsetWidth+DOM.getScrollbarSize(t).x),this._fillCols.foreach(function(t){var n=this.getActualColWidth(t.getIndex());n-=Math.round(t.fill*e),this.setColSize(t,n)},this)},P._updateResizeHandles=function(){this._model.foreachCol(function(e){var t;e._resizeHandle&&(t=e._button.getElement().parentNode,e._resizeHandle.style.left=t.offsetLeft+t.offsetWidth+"px")})},P._handle_focusKeys=function(e){var t,n=this.getGroup(),r=e.focusedWidget;switch(e.keyCode){case DlKeyboard.ARROW_UP:case DlKeyboard.ARROW_DOWN:case DlKeyboard.PAGE_UP:case DlKeyboard.PAGE_DOWN:t=e.keyCode==DlKeyboard.ARROW_UP||e.keyCode==DlKeyboard.PAGE_UP?this.getPrevRow(r):this.getNextRow(r),t?(t.focus(),e.shiftKey&&this._selType=="multiple"?(n.maxChecked(null),r.checked(!0),t.checked(!0)):this._selType!="multiple"&&(n.maxChecked(1),t.checked(!0))):(e.shiftKey||e.ctrlKey)&&r.checked(!0),e.domStop=!0,DlException.stopEventBubbling();break;case DlKeyboard.HOME:case DlKeyboard.END:t=e.keyCode==DlKeyboard.HOME?this.getRowByIndex(0):this.getRowByIndex(this.getBodyTable().rows.length-1),t&&(t.focus(),e.domStop=!0,this._selType!="multiple"&&(e.keyCode=DlKeyboard.ENTER,t._handle_focusKeys(e)),DlException.stopEventBubbling())}return BASE._handle_focusKeys.call(this,e)},P.getNextRow=function(e){return this.getRowByIndex(e.getModel().getIndex()+1)},P.getPrevRow=function(e){return this.getRowByIndex(e.getModel().getIndex()-1)}})(),function(){function DlGridRow(e){e&&(this._customMoveKeys=!0,D.setDefaults(this,e),DlAbstractButton.call(this,e))}function getTooltip(){var e=this.args.widget;return e.getModel().tooltip}function onDestroy(){this._model.removeEventListener("onChange",this._on_modelChange)}function displayCell(e,t,n){e.firstChild?e.firstChild.innerHTML=t.getContent():e.innerHTML='<div class="DlGrid-cellData">'+t.getContent()+"</div>",e.className="DlGrid-align-"+t.getStyle("textAlign",n.getStyle("textAlign","left"))}var BASE=DlGridRow.inherits(DlAbstractButton);eval(Dynarch.EXPORT("DlGridRow",!0)),D.DEFAULT_ARGS={_tagName:["tagName","tr"],_classes:["classes",{active:"DlGridRow-active",hover:"DlGridRow-hover",checked:"DlGridRow-1",unchecked:"DlGridRow-0",empty:"DlGridRow-empty",disabled:"DlGridRow-disabled"}],_btnType:["type",DlButton.TYPE.TWOSTATE],_model:["model",null],_focusable:["focusable",!0],__tooltip:["tooltip",getTooltip]},P.getModel=function(){return this._model},P._onClick=function(e){this.parent.getGroup().maxChecked(e.ctrlKey&&this.parent._selType=="multiple"?null:1),BASE._onClick.call(this,e)},P._handle_focusKeys=function(e){var t=this.parent,n=t.getGroup();if(e.keyCode!=DlKeyboard.ENTER)return BASE._handle_focusKeys.call(this,e);n.maxChecked(e.shiftKey||e.ctrlKey&&t._selType=="multiple"?null:1),this.applyHooks("onClick",[e]),e.domStop=!0},P._createElement=function(){var e;DlWidget.prototype._createElement.call(this),e=this.getElement(),this._model.foreachCell(function(t,n){var r=CE("td",null,null,e);displayCell(r,t,n)},this),this._on_modelChange=this._on_modelChange.$(this),this._model.addEventListener("onChange",this._on_modelChange),this.addEventListener("onDestroy",onDestroy)},P._on_modelChange=function(e,t,n){switch(n){case"value":displayCell(this.getElement().cells[t.getIndex()],t,this._model.model.getColByIndex(t.getIndex()))}}}(),function(){function DlGridHeadLabel(e){e&&(this.column=e.column,e.focusable=!1,this.__withIconClass="DlButton-withIcon",DlButton.call(this,e),this.column.isSortable||(this.__disabled=!0))}var BASE=DlGridHeadLabel.inherits(DlButton);eval(Dynarch.EXPORT("DlGridHeadLabel")),P.setWidth=function(e){this.setOuterSize({x:e})},P.label=function(){this.setContent("<div class='DlButton-Label'>"+this._label+"</div>")},P._onClick=function(){this.column.sort()},D.DEFAULT_ARGS={_classes:["classes",{active:"DlGridHeadLabel-active",hover:"DlGridHeadLabel-hover",checked:"DlGridHeadLabel-1",unchecked:"DlGridHeadLabel-0",empty:"DlGridHeadLabel-empty",disabled:"DlGridHeadLabel-disabled"}]}}();